P8105 HW2
================
Yutong Mao (UNI: ym3139)
2025-10-01

# Problem 1

``` r
library(tidyverse)

# --- Load data ---
pols  <- readr::read_csv("data/fivethirtyeight_datasets/pols-month.csv")
snp   <- readr::read_csv("data/fivethirtyeight_datasets/snp.csv")
unemp <- readr::read_csv("data/fivethirtyeight_datasets/unemployment.csv")
```

``` r
pols_clean <- pols |>
  tidyr::separate(
    mon, into = c("year", "month_num", "day"),
    sep = "-", convert = TRUE
  ) |>
  dplyr::mutate(
    month = month.name[month_num],               
    president = dplyr::case_when(               
      prez_gop == 1 ~ "gop",
      prez_dem == 1 ~ "dem",
      TRUE ~ NA_character_
    )
  ) |>
  dplyr::select(                                
    year, month, president,
    gov_gop, sen_gop, rep_gop,
    gov_dem, sen_dem, rep_dem
  ) |>
  dplyr::arrange(year, match(month, month.name))

dplyr::glimpse(pols_clean)
```

    ## Rows: 822
    ## Columns: 9
    ## $ year      <int> 1947, 1947, 1947, 1947, 1947, 1947, 1947, 1947, 1947, 1947, …
    ## $ month     <chr> "January", "February", "March", "April", "May", "June", "Jul…
    ## $ president <chr> "dem", "dem", "dem", "dem", "dem", "dem", "dem", "dem", "dem…
    ## $ gov_gop   <dbl> 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 24, 24, 22, 22, 22, …
    ## $ sen_gop   <dbl> 51, 51, 51, 51, 51, 51, 51, 51, 51, 51, 51, 51, 53, 53, 53, …
    ## $ rep_gop   <dbl> 253, 253, 253, 253, 253, 253, 253, 253, 253, 253, 253, 253, …
    ## $ gov_dem   <dbl> 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 24, 24, 24, …
    ## $ sen_dem   <dbl> 45, 45, 45, 45, 45, 45, 45, 45, 45, 45, 45, 45, 48, 48, 48, …
    ## $ rep_dem   <dbl> 198, 198, 198, 198, 198, 198, 198, 198, 198, 198, 198, 198, …

``` r
snp_clean <- snp |>
  dplyr::mutate(
    date = as.Date(date, tryFormats = c("%Y-%m-%d", "%m/%d/%Y"))
  ) |>
  dplyr::transmute(
    year  = as.integer(format(date, "%Y")),
    month_num = as.integer(format(date, "%m")),
    month = month.name[month_num],
    close
  ) |>
  dplyr::arrange(year, month_num) |>
  dplyr::select(-month_num)

dplyr::glimpse(snp_clean)
```

    ## Rows: 787
    ## Columns: 3
    ## $ year  <int> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1…
    ## $ month <chr> "January", "February", "March", "April", "May", "June", "July", …
    ## $ close <dbl> 1394.46, 1366.42, 1498.58, 1452.43, 1420.60, 1454.60, 1430.83, 1…

``` r
unemp_tidy <- unemp |>
  dplyr::rename(year = Year) |>
  tidyr::pivot_longer(
    cols = -year, names_to = "month", values_to = "unemployment_rate"
  ) |>
  dplyr::mutate(
    month = factor(month, levels = month.abb, labels = month.name),
    month = as.character(month)
  ) |>
  dplyr::arrange(year, match(month, month.name))

dplyr::glimpse(unemp_tidy)
```

    ## Rows: 816
    ## Columns: 3
    ## $ year              <dbl> 1948, 1948, 1948, 1948, 1948, 1948, 1948, 1948, 1948…
    ## $ month             <chr> "January", "February", "March", "April", "May", "Jun…
    ## $ unemployment_rate <dbl> 3.4, 3.8, 4.0, 3.9, 3.5, 3.6, 3.6, 3.9, 3.8, 3.7, 3.…

``` r
pols_snp <- dplyr::left_join(pols_clean, snp_clean, by = c("year", "month"))
merged   <- dplyr::left_join(pols_snp,  unemp_tidy, by = c("year", "month"))

dplyr::glimpse(merged)
```

    ## Rows: 822
    ## Columns: 11
    ## $ year              <dbl> 1947, 1947, 1947, 1947, 1947, 1947, 1947, 1947, 1947…
    ## $ month             <chr> "January", "February", "March", "April", "May", "Jun…
    ## $ president         <chr> "dem", "dem", "dem", "dem", "dem", "dem", "dem", "de…
    ## $ gov_gop           <dbl> 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 24, 24, 22, …
    ## $ sen_gop           <dbl> 51, 51, 51, 51, 51, 51, 51, 51, 51, 51, 51, 51, 53, …
    ## $ rep_gop           <dbl> 253, 253, 253, 253, 253, 253, 253, 253, 253, 253, 25…
    ## $ gov_dem           <dbl> 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 24, …
    ## $ sen_dem           <dbl> 45, 45, 45, 45, 45, 45, 45, 45, 45, 45, 45, 45, 48, …
    ## $ rep_dem           <dbl> 198, 198, 198, 198, 198, 198, 198, 198, 198, 198, 19…
    ## $ close             <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
    ## $ unemployment_rate <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, 3.4,…

``` r
dplyr::count(merged, year, sort = TRUE) |> head(3)
```

    ## # A tibble: 3 × 2
    ##    year     n
    ##   <dbl> <int>
    ## 1  1947    12
    ## 2  1948    12
    ## 3  1949    12

### About the datasets and the merged result

The `pols-month` dataset tracks the monthly number of U.S. national
politicians by party, together with the president’s affiliation. After
cleaning, it contains 822 rows and 9 columns. Key variables are `year`,
`month`, `president`, and the counts of governors, senators, and
representatives from both parties (`gov_*`, `sen_*`, `rep_*`).

The `snp` dataset gives monthly closing values of the S&P index. Once
processed, it keeps only `year`, `month`, and `close`, with a total of
787 observations.

The `unemployment` dataset provides monthly unemployment rates. After
being reshaped into a long format, it has 816 rows. The main variables
are `year`, `month`, and `unemployment_rate`.

When these three datasets are merged by `year` and `month`, the
resulting data frame `merged` includes 822 rows and 11 columns. The time
span goes from 1947 to 2015. In the final version, the most important
variables are the president’s party (`president`), the S&P closing value
(`close`), and the unemployment rate (`unemployment_rate`).

# Problem 2

``` r
library(readxl)
library(dplyr)
library(janitor)

trash_file <- "data/202409 Trash Wheel Collection Data.xlsx"
```

``` r
read_trashwheel_one <- function(sheet, wheel_label) {
  df <- read_excel(trash_file, sheet = sheet, skip = 1) |>
    clean_names() |>
    filter(!is.na(dumpster))

  if (!"sports_balls" %in% names(df) && "sports" %in% names(df)) df <- rename(df, sports_balls = sports)
  if (!"cigarette" %in% names(df) && "cigarette_butts" %in% names(df)) df <- rename(df, cigarette = cigarette_butts)
  if (!"weight" %in% names(df) && "weight_tons" %in% names(df)) df <- rename(df, weight = weight_tons)
  if (!"volume" %in% names(df) && "volume_cubic_yards" %in% names(df)) df <- rename(df, volume = volume_cubic_yards)
  if (!"plastic" %in% names(df) && "plastic_bottles" %in% names(df)) df <- rename(df, plastic = plastic_bottles)
  if (!"glass" %in% names(df) && "glass_bottles" %in% names(df)) df <- rename(df, glass = glass_bottles)
  if (!"wrapper" %in% names(df) && "wrappers" %in% names(df)) df <- rename(df, wrapper = wrappers)
  if (!"homes" %in% names(df) && "homes_powered" %in% names(df)) df <- rename(df, homes = homes_powered)
  if (!"sports_balls" %in% names(df)) df$sports_balls <- NA_real_

  df |>
    mutate(
      date = suppressWarnings(as.Date(date)),
      year = as.integer(year),
      month = as.character(month),
      sports_balls = as.integer(round(sports_balls)),
      wheel = wheel_label
    ) |>
    select(any_of(c(
      "wheel","dumpster","date","month","year","weight","volume",
      "plastic","polystyrene","cigarette","glass","plastic_bags",
      "wrapper","sports_balls","homes"
    )))
}
```

``` r
mr   <- read_trashwheel_one("Mr. Trash Wheel", "Mr. Trash Wheel")
prof <- read_trashwheel_one("Professor Trash Wheel", "Professor Trash Wheel")
gwyn <- read_trashwheel_one("Gwynnda Trash Wheel", "Gwynnda Trash Wheel")

trash_all <- bind_rows(mr, prof, gwyn) |>
  relocate(wheel, dumpster, date, month, year)
```

``` r
prof_total_weight_tons <- trash_all |>
  filter(wheel == "Professor Trash Wheel") |>
  summarise(total_weight_tons = sum(weight, na.rm = TRUE))

gwyn_june2022_cigs <- trash_all |>
  filter(wheel == "Gwynnda Trash Wheel", year == 2022, month == "June") |>
  summarise(total_cigs = sum(cigarette, na.rm = TRUE))

prof_total_weight_tons
```

    ## # A tibble: 1 × 1
    ##   total_weight_tons
    ##               <dbl>
    ## 1              247.

``` r
gwyn_june2022_cigs
```

    ## # A tibble: 1 × 1
    ##   total_cigs
    ##        <dbl>
    ## 1      18120

After cleaning and merging the datasets, we ended up with a tidy data
frame containing 1033 observations and 15 variables. The dataset records
information from different Trash Wheels and includes variables such as
collection date, dumpster number, total weight of trash (in tons), and
counts of items like plastic bottles, polystyrene, cigarette butts,
glass bottles, plastic bags, wrappers, and sports balls. For example,
the variable *weight* measures how many tons of trash were collected for
each dumpster, while *cigarette* and *sports_balls* keep track of more
specific items. Altogether, Professor Trash Wheel collected 246.74 tons
of trash. Looking at a single case, Gwynnda removed 1.812^{4} cigarette
butts in June 2022. These results give us a concrete picture of how much
waste is entering the harbor and also highlight the important role each
Trash Wheel plays in improving the local environment.

# Problem 3

``` r
library(readr)
library(dplyr)
library(janitor)
library(tidyr)

zip_file  <- "data/zillow_data/Zip Codes.csv"
zori_file <- "data/zillow_data/Zip_zori_uc_sfrcondomfr_sm_month_NYC.csv"

zip_raw  <- read_csv(zip_file,  show_col_types = FALSE) |> clean_names()
zori_raw <- read_csv(zori_file, show_col_types = FALSE) |> clean_names()
```

``` r
glimpse(zip_raw)
```

    ## Rows: 322
    ## Columns: 7
    ## $ county       <chr> "Bronx", "Bronx", "Bronx", "Bronx", "Bronx", "Bronx", "Br…
    ## $ state_fips   <dbl> 36, 36, 36, 36, 36, 36, 36, 36, 36, 36, 36, 36, 36, 36, 3…
    ## $ county_code  <chr> "005", "005", "005", "005", "005", "005", "005", "005", "…
    ## $ county_fips  <dbl> 36005, 36005, 36005, 36005, 36005, 36005, 36005, 36005, 3…
    ## $ zip_code     <dbl> 10451, 10452, 10453, 10454, 10455, 10456, 10457, 10458, 1…
    ## $ file_date    <chr> "7/25/07", "7/25/07", "7/25/07", "7/25/07", "7/25/07", "7…
    ## $ neighborhood <chr> "High Bridge and Morrisania", "High Bridge and Morrisania…

``` r
glimpse(zori_raw)
```

    ## Rows: 149
    ## Columns: 125
    ## $ region_id   <dbl> 62080, 62093, 62019, 62046, 61807, 62085, 62037, 62018, 61…
    ## $ size_rank   <dbl> 4, 7, 9, 16, 17, 18, 19, 20, 29, 32, 36, 39, 40, 43, 47, 4…
    ## $ region_name <dbl> 11368, 11385, 11208, 11236, 10467, 11373, 11226, 11207, 10…
    ## $ region_type <chr> "zip", "zip", "zip", "zip", "zip", "zip", "zip", "zip", "z…
    ## $ state_name  <chr> "NY", "NY", "NY", "NY", "NY", "NY", "NY", "NY", "NY", "NY"…
    ## $ state       <chr> "NY", "NY", "NY", "NY", "NY", "NY", "NY", "NY", "NY", "NY"…
    ## $ city        <chr> "New York", "New York", "New York", "New York", "New York"…
    ## $ metro       <chr> "New York-Newark-Jersey City, NY-NJ-PA", "New York-Newark-…
    ## $ county_name <chr> "Queens County", "Queens County", "Kings County", "Kings C…
    ## $ x2015_01_31 <dbl> NA, NA, NA, NA, NA, NA, 1919.726, 1943.311, 3054.576, NA, …
    ## $ x2015_02_28 <dbl> NA, NA, NA, NA, NA, NA, 1947.088, 1851.295, 3053.302, NA, …
    ## $ x2015_03_31 <dbl> NA, NA, NA, NA, NA, NA, 2038.567, 1851.512, 3049.818, NA, …
    ## $ x2015_04_30 <dbl> NA, NA, NA, NA, NA, NA, 2041.355, 1876.733, 3073.585, NA, …
    ## $ x2015_05_31 <dbl> NA, NA, NA, NA, NA, NA, 2053.751, 1972.097, 3093.156, NA, …
    ## $ x2015_06_30 <dbl> NA, NA, NA, NA, NA, NA, 2033.709, 2025.955, 3120.443, NA, …
    ## $ x2015_07_31 <dbl> NA, NA, NA, NA, NA, NA, 2056.747, 2034.935, 3130.740, NA, …
    ## $ x2015_08_31 <dbl> NA, NA, NA, NA, NA, NA, 2071.559, 2016.905, 3128.406, NA, …
    ## $ x2015_09_30 <dbl> NA, NA, NA, NA, NA, NA, 2092.795, 2046.119, 3125.705, NA, …
    ## $ x2015_10_31 <dbl> NA, NA, NA, NA, NA, NA, 2093.826, 2052.770, 3126.853, NA, …
    ## $ x2015_11_30 <dbl> NA, NA, NA, NA, NA, NA, 2095.349, 2108.550, 3129.706, NA, …
    ## $ x2015_12_31 <dbl> NA, NA, NA, NA, NA, NA, 2088.164, 2062.484, 3125.624, NA, …
    ## $ x2016_01_31 <dbl> NA, NA, NA, NA, NA, NA, 2089.653, 2068.113, 3115.547, NA, …
    ## $ x2016_02_29 <dbl> NA, NA, NA, NA, NA, NA, 2082.460, 2075.443, 3111.635, NA, …
    ## $ x2016_03_31 <dbl> NA, NA, NA, NA, NA, NA, 2131.828, 2166.531, 3126.976, NA, …
    ## $ x2016_04_30 <dbl> NA, NA, NA, NA, NA, NA, 2151.524, 2198.191, 3134.421, NA, …
    ## $ x2016_05_31 <dbl> NA, 2266.140, NA, NA, 1349.679, NA, 2171.467, 2163.246, 31…
    ## $ x2016_06_30 <dbl> NA, 2292.023, NA, NA, 1327.656, NA, 2195.605, 2134.050, 31…
    ## $ x2016_07_31 <dbl> NA, 2320.788, NA, NA, 1351.738, NA, 2235.378, 2125.281, 31…
    ## $ x2016_08_31 <dbl> NA, 2343.339, NA, NA, 1313.098, NA, 2240.782, 2149.885, 32…
    ## $ x2016_09_30 <dbl> NA, 2337.120, NA, NA, 1331.150, NA, 2202.912, 2132.201, 32…
    ## $ x2016_10_31 <dbl> NA, 2345.339, NA, NA, 1317.193, NA, 2175.157, 2131.459, 31…
    ## $ x2016_11_30 <dbl> NA, 2320.083, NA, NA, 1307.569, NA, 2203.503, 2144.048, 31…
    ## $ x2016_12_31 <dbl> NA, 2326.450, NA, NA, 1294.087, NA, 2220.357, 2150.612, 30…
    ## $ x2017_01_31 <dbl> NA, 2310.855, NA, NA, 1354.713, NA, 2230.477, 2149.877, 30…
    ## $ x2017_02_28 <dbl> NA, 2313.101, NA, NA, 1381.230, NA, 2222.774, 2119.797, 30…
    ## $ x2017_03_31 <dbl> NA, 2316.134, NA, NA, 1443.584, NA, 2227.372, 2114.796, 30…
    ## $ x2017_04_30 <dbl> NA, 2309.757, NA, NA, 1427.754, NA, 2217.893, 2124.847, 31…
    ## $ x2017_05_31 <dbl> NA, 2336.220, NA, NA, NA, NA, 2224.578, 2113.990, 3146.901…
    ## $ x2017_06_30 <dbl> NA, 2327.477, NA, NA, 1419.295, NA, 2246.103, 2110.918, 31…
    ## $ x2017_07_31 <dbl> NA, 2349.503, NA, NA, 1427.326, NA, 2268.897, 2113.950, 32…
    ## $ x2017_08_31 <dbl> NA, 2354.110, NA, NA, 1391.902, NA, 2266.585, 2154.685, 32…
    ## $ x2017_09_30 <dbl> NA, 2393.023, NA, NA, 1388.167, NA, 2253.781, 2190.012, 32…
    ## $ x2017_10_31 <dbl> NA, 2363.952, NA, NA, 1402.915, NA, 2233.249, 2209.270, 31…
    ## $ x2017_11_30 <dbl> NA, 2360.901, NA, NA, 1443.141, NA, 2214.707, 2197.699, 31…
    ## $ x2017_12_31 <dbl> NA, 2336.269, NA, NA, 1448.317, NA, 2203.283, 2195.972, 30…
    ## $ x2018_01_31 <dbl> NA, 2331.220, NA, NA, 1415.071, NA, 2212.000, 2173.922, 30…
    ## $ x2018_02_28 <dbl> NA, 2314.654, NA, NA, 1447.512, NA, 2242.629, 2161.329, 30…
    ## $ x2018_03_31 <dbl> NA, 2317.821, NA, NA, 1475.749, NA, 2265.593, 2164.720, 30…
    ## $ x2018_04_30 <dbl> NA, 2337.118, NA, NA, 1550.592, NA, 2292.588, 2225.315, 31…
    ## $ x2018_05_31 <dbl> NA, 2352.811, NA, NA, 1557.876, NA, 2295.173, 2250.959, 31…
    ## $ x2018_06_30 <dbl> NA, 2362.330, NA, NA, 1554.092, NA, 2304.912, 2259.032, 32…
    ## $ x2018_07_31 <dbl> NA, 2367.660, NA, NA, 1551.874, NA, 2320.557, 2230.589, 32…
    ## $ x2018_08_31 <dbl> NA, 2376.613, NA, NA, 1552.840, NA, 2349.465, 2259.636, 32…
    ## $ x2018_09_30 <dbl> NA, 2380.886, NA, NA, 1580.368, NA, 2369.397, 2260.747, 32…
    ## $ x2018_10_31 <dbl> NA, 2402.277, NA, NA, 1576.065, NA, 2351.768, 2241.267, 32…
    ## $ x2018_11_30 <dbl> NA, 2393.917, NA, NA, 1554.715, NA, 2334.290, 2241.702, 32…
    ## $ x2018_12_31 <dbl> NA, 2397.149, NA, NA, 1593.641, NA, 2306.881, 2241.726, 32…
    ## $ x2019_01_31 <dbl> NA, 2374.795, NA, NA, 1588.411, NA, 2322.166, 2267.492, 32…
    ## $ x2019_02_28 <dbl> NA, 2397.457, NA, NA, 1600.744, NA, 2310.874, 2262.747, 32…
    ## $ x2019_03_31 <dbl> NA, 2381.838, NA, NA, 1578.046, NA, 2337.374, 2300.330, 31…
    ## $ x2019_04_30 <dbl> NA, 2398.852, NA, NA, 1572.738, NA, 2320.309, 2282.050, 32…
    ## $ x2019_05_31 <dbl> NA, 2381.123, NA, NA, 1587.081, NA, 2348.144, 2312.998, 32…
    ## $ x2019_06_30 <dbl> NA, 2440.723, NA, NA, 1568.751, NA, 2347.740, 2308.482, 33…
    ## $ x2019_07_31 <dbl> NA, 2471.034, NA, NA, 1613.196, NA, 2377.157, 2344.878, 33…
    ## $ x2019_08_31 <dbl> NA, 2495.005, NA, NA, 1620.662, NA, 2401.689, 2341.534, 33…
    ## $ x2019_09_30 <dbl> NA, 2476.095, NA, NA, 1685.971, NA, 2419.742, 2348.960, 33…
    ## $ x2019_10_31 <dbl> NA, 2464.924, NA, NA, 1699.779, NA, 2413.602, 2356.870, 33…
    ## $ x2019_11_30 <dbl> NA, 2488.450, NA, NA, 1695.050, NA, 2378.537, 2385.016, 33…
    ## $ x2019_12_31 <dbl> NA, 2498.628, NA, NA, 1669.128, NA, 2348.024, 2409.248, 32…
    ## $ x2020_01_31 <dbl> NA, 2509.859, NA, NA, 1649.561, NA, 2357.056, 2418.346, 32…
    ## $ x2020_02_29 <dbl> NA, 2515.646, NA, NA, 1665.102, NA, 2354.012, 2406.290, 33…
    ## $ x2020_03_31 <dbl> NA, 2501.732, NA, NA, 1668.471, NA, 2390.353, 2384.940, 33…
    ## $ x2020_04_30 <dbl> NA, 2475.083, NA, NA, 1653.317, NA, 2384.131, 2397.553, 32…
    ## $ x2020_05_31 <dbl> NA, 2475.563, NA, NA, 1612.794, NA, 2394.843, 2400.946, 32…
    ## $ x2020_06_30 <dbl> NA, 2469.365, NA, NA, 1598.750, NA, 2372.863, 2390.648, 31…
    ## $ x2020_07_31 <dbl> NA, 2475.826, NA, NA, 1655.226, NA, 2375.547, 2357.104, 31…
    ## $ x2020_08_31 <dbl> NA, 2427.843, NA, NA, 1699.814, NA, 2352.791, 2326.858, 30…
    ## $ x2020_09_30 <dbl> NA, 2401.526, NA, NA, 1745.707, NA, 2321.016, 2270.901, 29…
    ## $ x2020_10_31 <dbl> NA, 2368.533, NA, NA, 1724.810, NA, 2286.740, 2224.135, 28…
    ## $ x2020_11_30 <dbl> NA, 2337.224, NA, NA, 1774.450, NA, 2268.131, 2167.380, 28…
    ## $ x2020_12_31 <dbl> NA, 2305.878, NA, NA, 1725.417, NA, 2223.454, 2164.536, 27…
    ## $ x2021_01_31 <dbl> NA, 2292.884, NA, NA, 1744.514, NA, 2180.768, 2142.852, 27…
    ## $ x2021_02_28 <dbl> NA, 2277.712, NA, NA, 1701.264, NA, 2182.021, 2121.733, 28…
    ## $ x2021_03_31 <dbl> NA, 2282.339, NA, NA, 1737.235, NA, 2209.309, 2102.816, 28…
    ## $ x2021_04_30 <dbl> NA, 2278.929, NA, NA, 1690.341, 1872.391, 2254.320, 2111.9…
    ## $ x2021_05_31 <dbl> NA, 2322.021, NA, NA, 1715.512, 1875.980, 2278.554, 2191.8…
    ## $ x2021_06_30 <dbl> NA, 2368.377, NA, NA, 1725.934, 1908.656, 2310.224, 2261.8…
    ## $ x2021_07_31 <dbl> NA, 2420.586, NA, NA, 1751.695, 1930.109, 2349.893, 2316.8…
    ## $ x2021_08_31 <dbl> NA, 2449.848, NA, NA, 1742.938, 1949.615, 2367.497, 2336.2…
    ## $ x2021_09_30 <dbl> NA, 2482.230, NA, NA, 1772.303, 1966.494, 2398.880, 2364.1…
    ## $ x2021_10_31 <dbl> NA, 2518.714, NA, NA, 1807.374, 1910.506, 2397.910, 2412.8…
    ## $ x2021_11_30 <dbl> NA, 2556.784, NA, NA, 1812.226, 1934.053, 2409.960, 2413.5…
    ## $ x2021_12_31 <dbl> NA, 2580.724, NA, NA, 1747.475, 1923.586, 2411.932, 2448.9…
    ## $ x2022_01_31 <dbl> NA, 2592.727, NA, NA, 1728.976, 1927.948, 2437.651, 2452.6…
    ## $ x2022_02_28 <dbl> NA, 2591.473, NA, NA, 1785.026, 1969.994, 2473.804, 2473.5…
    ## $ x2022_03_31 <dbl> NA, 2607.010, 2432.634, NA, 1831.988, 2023.199, 2515.255, …
    ## $ x2022_04_30 <dbl> NA, 2657.466, 2468.666, NA, 1886.640, 2100.825, 2547.030, …
    ## $ x2022_05_31 <dbl> NA, 2727.357, 2553.099, 2328.869, 1881.483, 2107.368, 2591…
    ## $ x2022_06_30 <dbl> NA, 2830.789, 2571.974, 2376.032, 1904.170, 2138.288, 2641…
    ## $ x2022_07_31 <dbl> NA, 2893.427, 2541.777, 2347.321, 1937.096, 2166.511, 2678…
    ## $ x2022_08_31 <dbl> NA, 2951.086, 2549.192, 2400.155, 1944.353, 2151.894, 2685…
    ## $ x2022_09_30 <dbl> NA, 2957.775, 2533.571, 2397.660, 1931.878, 2144.004, 2685…
    ## $ x2022_10_31 <dbl> NA, 2966.494, 2596.307, 2524.344, 1893.956, 2141.909, 2692…
    ## $ x2022_11_30 <dbl> NA, 2937.695, 2624.750, 2502.490, 1891.447, 2163.435, 2686…
    ## $ x2022_12_31 <dbl> NA, 2898.732, 2660.759, 2582.495, 1899.311, 2181.641, 2657…
    ## $ x2023_01_31 <dbl> NA, 2851.205, 2683.873, 2432.282, 1929.648, 2213.842, 2651…
    ## $ x2023_02_28 <dbl> NA, 2847.664, 2685.560, 2429.336, 1945.849, 2226.211, 2646…
    ## $ x2023_03_31 <dbl> NA, 2865.429, 2657.591, 2391.820, 1958.650, 2214.526, 2676…
    ## $ x2023_04_30 <dbl> NA, 2908.589, 2672.800, 2451.315, 1909.791, 2217.911, 2681…
    ## $ x2023_05_31 <dbl> NA, 2950.697, 2699.051, 2501.957, 1963.970, 2218.745, 2706…
    ## $ x2023_06_30 <dbl> NA, 2986.174, 2825.592, 2598.722, 2049.137, 2253.525, 2728…
    ## $ x2023_07_31 <dbl> NA, 3004.259, 2817.253, 2642.102, 2084.984, 2261.120, 2748…
    ## $ x2023_08_31 <dbl> NA, 3021.107, 2797.145, 2672.396, 2100.269, 2295.725, 2757…
    ## $ x2023_09_30 <dbl> NA, 3039.225, 2773.578, 2715.256, 2182.744, 2275.544, 2743…
    ## $ x2023_10_31 <dbl> NA, 3042.726, 2815.385, 2700.885, 2238.053, 2302.135, 2722…
    ## $ x2023_11_30 <dbl> NA, 3022.294, 2934.593, 2743.458, 2317.342, 2293.275, 2713…
    ## $ x2023_12_31 <dbl> NA, 2985.509, 2977.254, 2753.950, 2243.914, 2290.069, 2716…
    ## $ x2024_01_31 <dbl> NA, 2976.598, 3015.684, 2848.811, 2269.451, 2283.986, 2745…
    ## $ x2024_02_29 <dbl> NA, 2971.280, 2987.130, 2899.215, 2233.032, 2273.511, 2741…
    ## $ x2024_03_31 <dbl> NA, 3022.816, 2963.105, 2977.176, 2244.841, 2281.456, 2737…
    ## $ x2024_04_30 <dbl> NA, 3032.851, 2895.445, 2935.365, 2303.026, 2302.458, 2726…
    ## $ x2024_05_31 <dbl> NA, 3102.032, 2817.406, 2959.498, 2282.180, 2377.143, 2750…
    ## $ x2024_06_30 <dbl> NA, 3132.088, 2858.719, 2847.246, 2309.057, 2439.551, 2766…
    ## $ x2024_07_31 <dbl> 2322.418, 3203.117, 2816.037, 2862.954, 2294.031, 2491.626…
    ## $ x2024_08_31 <dbl> 2282.500, 3199.751, 2895.667, 2976.389, 2271.611, 2476.333…

``` r
# ZIP–neighborhoods
zip_codes <- zip_raw |>
  transmute(
    zip = sprintf("%05d", as.integer(zip_code)),
    county = county,
    borough = case_match(
      county,
      "New York" ~ "Manhattan",
      "Kings"    ~ "Brooklyn",
      "Queens"   ~ "Queens",
      "Bronx"    ~ "Bronx",
      "Richmond" ~ "Staten Island",
      .default   = county
    ),
    neighborhood
  )
```

``` r
# Zillow ZORI wide -> long
zori_tidy <- zori_raw |>
  rename(zip = region_name) |>
  mutate(zip = sprintf("%05d", as.integer(zip))) |>
  pivot_longer(
    cols = starts_with("x20"),
    names_to  = "date_str",
    values_to = "rent"
  ) |>
  mutate(
    month = as.Date(sub("^x", "", date_str), format = "%Y_%m_%d"),
    month = as.Date(format(month, "%Y-%m-01"))
  ) |>
  select(zip, county_name, month, rent) |>
  arrange(zip, month)
```

``` r
rent_merged <- zori_tidy |>
  left_join(zip_codes, by = "zip") |>
  relocate(zip, borough, neighborhood, county_name, month, rent)

n_obs_total <- nrow(rent_merged)
n_zip       <- n_distinct(rent_merged$zip)
n_hood      <- n_distinct(rent_merged$neighborhood, na.rm = TRUE)

zips_in_zip_only <- setdiff(zip_codes$zip, unique(zori_tidy$zip))
zips_only_df <- tibble(zip = sort(zips_in_zip_only)) |>
  left_join(select(zip_codes, zip, borough, neighborhood), by = "zip")

jan2020 <- rent_merged |>
  filter(month == as.Date("2020-01-01")) |>
  select(zip, rent_2020 = rent)

jan2021 <- rent_merged |>
  filter(month == as.Date("2021-01-01")) |>
  select(zip, rent_2021 = rent)

drop_tbl <- rent_merged |>
  distinct(zip, borough, neighborhood) |>
  left_join(jan2020, by = "zip") |>
  left_join(jan2021, by = "zip") |>
  mutate(diff_2021_vs_2020 = rent_2021 - rent_2020) |>
  arrange(diff_2021_vs_2020) |>
  slice_head(n = 10)
```

``` r
zips_in_zip_only <- setdiff(zip_codes$zip, unique(zori_tidy$zip))

zips_only_df <- tibble(
  zip = sort(zips_in_zip_only)
) |>
  left_join(select(zip_codes, zip, borough, neighborhood), by = "zip")
jan2020 <- rent_merged |>
  filter(month == as.Date("2020-01-01")) |>
  select(zip, rent_2020 = rent)

jan2021 <- rent_merged |>
  filter(month == as.Date("2021-01-01")) |>
  select(zip, rent_2021 = rent)

drop_tbl <- rent_merged |>
  distinct(zip, borough, neighborhood) |>
  left_join(jan2020, by = "zip") |>
  left_join(jan2021, by = "zip") |>
  mutate(diff_2021_vs_2020 = rent_2021 - rent_2020) |>
  arrange(diff_2021_vs_2020) |>
  slice_head(n = 10)
```

``` r
n_obs_total; n_zip; n_hood
```

    ## [1] 17516

    ## [1] 149

    ## [1] 42

``` r
zips_only_df
```

    ## # A tibble: 171 × 3
    ##    zip   borough   neighborhood       
    ##    <chr> <chr>     <chr>              
    ##  1 10008 Manhattan <NA>               
    ##  2 10020 Manhattan Chelsea and Clinton
    ##  3 10041 Manhattan <NA>               
    ##  4 10043 Manhattan <NA>               
    ##  5 10045 Manhattan <NA>               
    ##  6 10047 Manhattan <NA>               
    ##  7 10048 Manhattan <NA>               
    ##  8 10055 Manhattan <NA>               
    ##  9 10072 Manhattan <NA>               
    ## 10 10080 Manhattan <NA>               
    ## # ℹ 161 more rows

``` r
drop_tbl
```

    ## # A tibble: 10 × 6
    ##    zip   borough   neighborhood            rent_2020 rent_2021 diff_2021_vs_2020
    ##    <chr> <chr>     <chr>                       <dbl>     <dbl>             <dbl>
    ##  1 10007 Manhattan Lower Manhattan             6334.     5422.             -913.
    ##  2 10069 Manhattan <NA>                        4623.     3875.             -748.
    ##  3 10009 Manhattan Lower East Side             3406.     2692.             -714.
    ##  4 10016 Manhattan Gramercy Park and Murr…     3731.     3019.             -712.
    ##  5 10001 Manhattan Chelsea and Clinton         4108.     3398.             -710.
    ##  6 10002 Manhattan Lower East Side             3645.     2935.             -710.
    ##  7 10004 Manhattan Lower Manhattan             3150.     2444.             -706.
    ##  8 10038 Manhattan Lower Manhattan             3573.     2876.             -698.
    ##  9 10012 Manhattan Greenwich Village and …     3629.     2942.             -686.
    ## 10 10010 Manhattan Gramercy Park and Murr…     3697.     3012.             -685.

After cleaning and merging the two datasets, the final tidy dataset
contains 17516 observations. In total, there are 149 unique ZIP codes
and 42 distinct neighborhoods represented across New York City. Some ZIP
codes present in the ZIP code reference file are not included in the
Zillow rental dataset; for example, 10464, 10474, 10475. These omissions
may be due to low population density, limited rental market activity, or
a lack of sufficient listings in those areas.

When comparing rental prices during the pandemic, we observe substantial
declines. In particular, between January 2020 and January 2021, the ten
ZIP codes with the steepest drops in rent are shown in Table X. Many of
these are in Manhattan, reflecting broader out-migration and depressed
rental demand during the peak of COVID-19 restrictions.
